<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Idea Archive</title>
    <!-- React 및 관련 라이브러리 CDN -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;800&display=swap');
        body { 
            font-family: 'Pretendard', sans-serif; 
            -webkit-tap-highlight-color: transparent; 
            background-color: #F8FAFC;
            touch-action: manipulation;
            margin: 0;
            padding: 0;
        }
        input, textarea, button { font-family: inherit; font-size: 16px !important; }
        /* 입력창 포커스 시 줌 방지 및 부드러운 전환 */
        input:focus, textarea:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.2);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // 아이콘 컴포넌트 (렌더링 에러 방지)
        const Icon = ({ name, className }) => {
            const iconRef = useRef(null);
            useEffect(() => {
                if (window.lucide) {
                    window.lucide.createIcons();
                }
            }, [name]);
            return <i data-lucide={name} className={className}></i>;
        };

        const App = () => {
            const [url, setUrl] = useState('');
            const [category, setCategory] = useState('교육자료');
            const [memo, setMemo] = useState('');
            const [loading, setLoading] = useState(false);
            const [status, setStatus] = useState({ type: null, message: '' });

            // 구글 앱 스크립트 웹 앱 URL (선생님의 URL을 유지합니다)
            const GAS_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxBbw_PCgIIGypwCnQJ-f32PL0qPwV6gJeFsM1qtXs0V0gltg1MpKFzkxagkQJbTd0WVQ/exec"; 

            const categories = [
                { id: '교육자료', icon: 'book-open', color: 'text-blue-500', bgColor: 'bg-blue-50' },
                { id: '상담', icon: 'message-circle', color: 'text-rose-500', bgColor: 'bg-rose-50' },
                { id: 'ai테크', icon: 'cpu', color: 'text-violet-500', bgColor: 'bg-violet-50' },
                { id: '재테크', icon: 'wallet', color: 'text-amber-500', bgColor: 'bg-amber-50' },
            ];

            const showStatus = (type, message) => {
                setStatus({ type, message });
                if (type === 'success') {
                    // 3초 후 상태 메시지 자동 제거
                    setTimeout(() => setStatus({ type: null, message: '' }), 3000);
                }
            };

            const handleSave = async (e) => {
                // 이벤트 전파 및 기본 동작(페이지 이동) 철저히 차단
                if (e) {
                    e.preventDefault();
                    e.stopPropagation();
                }

                if (!url) {
                    showStatus('error', 'URL 주소를 먼저 입력해 주세요.');
                    return;
                }

                setLoading(true);
                setStatus({ type: null, message: '' });

                const payload = {
                    url: url,
                    category: category,
                    memo: memo
                };

                try {
                    // Blob을 사용한 전송 방식은 브라우저 리다이렉션 방해를 최소화합니다.
                    const blob = new Blob([JSON.stringify(payload)], { type: 'text/plain;charset=utf-8' });
                    
                    await fetch(GAS_WEB_APP_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        cache: 'no-cache',
                        body: blob
                    });

                    // 전송 즉시 UI 업데이트 (응답을 기다리지 않고 로컬에서 성공 처리)
                    showStatus('success', '아이디어가 안전하게 기록되었습니다!');
                    setUrl('');
                    setMemo('');
                } catch (error) {
                    console.error("Save Error:", error);
                    showStatus('error', '저장 중 문제가 발생했습니다.');
                } finally {
                    // 강제로 로딩 상태 해제하여 UI 복구 보장
                    setLoading(false);
                }
            };

            return (
                <div className="min-h-screen flex flex-col items-center p-6 text-slate-900">
                    {/* 배경 그라데이션 */}
                    <div className="fixed top-0 left-0 w-full h-80 bg-gradient-to-b from-indigo-100/30 to-transparent -z-10" />

                    {/* 헤더 */}
                    <header className="w-full max-w-md mt-6 mb-8 text-center">
                        <div className="inline-flex items-center justify-center w-14 h-14 bg-white rounded-2xl shadow-xl shadow-indigo-100/50 mb-4 border border-indigo-50">
                            <Icon name="sparkles" className="text-indigo-600 w-7 h-7" />
                        </div>
                        <h1 className="text-2xl font-black tracking-tight text-slate-800">Idea Archive</h1>
                        <p className="text-slate-400 font-medium mt-1 text-sm">당신의 영감을 시트에 저장하세요</p>
                    </header>

                    {/* 메인 폼 카드 */}
                    <div className="w-full max-w-md bg-white rounded-[2rem] shadow-[0_15px_50px_rgba(79,70,229,0.08)] p-7 border border-slate-50 relative">
                        <div className="space-y-7">
                            {/* URL 입력 필드 */}
                            <div>
                                <label className="flex items-center text-[10px] font-bold uppercase tracking-[0.2em] text-slate-400 mb-2.5 ml-1">
                                    <Icon name="link-2" className="w-3 h-3 mr-1.5 text-indigo-400" />
                                    Resource URL
                                </label>
                                <input
                                    type="url"
                                    placeholder="주소를 붙여넣으세요"
                                    className="w-full px-4 py-3.5 bg-slate-50 border-0 rounded-xl ring-1 ring-slate-100 focus:ring-2 focus:ring-indigo-500 transition-all outline-none text-slate-700 placeholder:text-slate-300"
                                    value={url}
                                    onChange={(e) => setUrl(e.target.value)}
                                />
                            </div>

                            {/* 카테고리 선택 */}
                            <div>
                                <label className="flex items-center text-[10px] font-bold uppercase tracking-[0.2em] text-slate-400 mb-3 ml-1">
                                    Category
                                </label>
                                <div className="grid grid-cols-2 gap-2.5">
                                    {categories.map((cat) => (
                                        <button
                                            key={cat.id}
                                            type="button"
                                            onClick={() => setCategory(cat.id)}
                                            className={`flex items-center p-3 rounded-xl transition-all duration-200 border ${
                                                category === cat.id 
                                                ? 'border-indigo-500 bg-indigo-50/50 shadow-sm ring-1 ring-indigo-500' 
                                                : 'border-slate-50 bg-white opacity-60 hover:opacity-100 hover:bg-slate-50'
                                            }`}
                                        >
                                            <div className={`p-2 rounded-lg mr-2 ${cat.bgColor} ${cat.color}`}>
                                                <Icon name={cat.icon} className="w-4 h-4" />
                                            </div>
                                            <span className={`text-xs font-bold ${category === cat.id ? 'text-indigo-900' : 'text-slate-500'}`}>
                                                {cat.id}
                                            </span>
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {/* 메모 입력 필드 */}
                            <div>
                                <label className="flex items-center text-[10px] font-bold uppercase tracking-[0.2em] text-slate-400 mb-2.5 ml-1">
                                    <Icon name="pen-line" className="w-3 h-3 mr-1.5 text-indigo-400" />
                                    Quick Memo
                                </label>
                                <textarea
                                    placeholder="간단한 메모를 남기세요"
                                    className="w-full px-4 py-3.5 bg-slate-50 border-0 rounded-xl ring-1 ring-slate-100 focus:ring-2 focus:ring-indigo-500 transition-all outline-none text-slate-700 placeholder:text-slate-300 h-20 resize-none"
                                    value={memo}
                                    onChange={(e) => setMemo(e.target.value)}
                                />
                            </div>

                            {/* 상태 메시지 */}
                            {status.message && (
                                <div className={`flex items-center p-4 rounded-xl text-xs font-semibold animate-in fade-in slide-in-from-bottom-2 ${
                                    status.type === 'success' ? 'bg-emerald-50 text-emerald-700 border border-emerald-100' : 'bg-rose-50 text-rose-700 border border-rose-100'
                                }`}>
                                    <Icon name={status.type === 'success' ? 'check-circle-2' : 'alert-circle'} className="w-4 h-4 mr-2.5 shrink-0" />
                                    {status.message}
                                </div>
                            )}

                            {/* 저장 버튼 (type="button"으로 지정하여 폼 제출 차단) */}
                            <button
                                type="button"
                                onClick={handleSave}
                                disabled={loading}
                                className={`w-full py-4.5 rounded-xl font-bold text-base flex items-center justify-center transition-all shadow-lg active:scale-95 ${
                                    loading 
                                    ? 'bg-slate-200 text-slate-400' 
                                    : 'bg-indigo-600 text-white shadow-indigo-100 hover:bg-indigo-700'
                                }`}
                                style={{ height: '60px' }}
                            >
                                {loading ? (
                                    <Icon name="loader-2" className="w-5 h-5 animate-spin" />
                                ) : (
                                    <div className="flex items-center">
                                        저장하기
                                        <Icon name="arrow-right" className="w-4 h-4 ml-2" />
                                    </div>
                                )}
                            </button>
                        </div>
                    </div>

                    <footer className="mt-auto py-8 text-slate-300 text-[9px] font-bold uppercase tracking-[0.3em]">
                        Cloud Sync Active
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
