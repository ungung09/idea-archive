<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Idea Archive</title>
    <!-- React 및 관련 라이브러리 CDN -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;800&display=swap');
        body { 
            font-family: 'Pretendard', sans-serif; 
            -webkit-tap-highlight-color: transparent; 
            background-color: #FDFDFF;
            touch-action: manipulation;
        }
        input, textarea, button { font-family: inherit; font-size: 16px !important; } /* 모바일 줌 방지 */
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // 아이콘 컴포넌트
        const Icon = ({ name, className }) => {
            useEffect(() => {
                if (window.lucide) {
                    window.lucide.createIcons();
                }
            }, [name]);
            return <i data-lucide={name} className={className}></i>;
        };

        const App = () => {
            const [url, setUrl] = useState('');
            const [category, setCategory] = useState('교육자료');
            const [memo, setMemo] = useState('');
            const [loading, setLoading] = useState(false);
            const [status, setStatus] = useState({ type: null, message: '' });

            const GAS_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxBbw_PCgIIGypwCnQJ-f32PL0qPwV6gJeFsM1qtXs0V0gltg1MpKFzkxagkQJbTd0WVQ/exec"; 

            const categories = [
                { id: '교육자료', icon: 'book-open', color: 'text-blue-500', bgColor: 'bg-blue-50' },
                { id: '상담', icon: 'message-circle', color: 'text-rose-500', bgColor: 'bg-rose-50' },
                { id: 'ai테크', icon: 'cpu', color: 'text-violet-500', bgColor: 'bg-violet-50' },
                { id: '재테크', icon: 'wallet', color: 'text-amber-500', bgColor: 'bg-amber-50' },
            ];

            const showStatus = (type, message) => {
                setStatus({ type, message });
                if (type === 'success') {
                    setTimeout(() => setStatus({ type: null, message: '' }), 3000);
                }
            };

            const handleSave = async () => {
                if (!url) {
                    showStatus('error', 'URL 주소를 입력해 주세요.');
                    return;
                }

                setLoading(true);
                setStatus({ type: null, message: '' });

                try {
                    // 전송 데이터 준비
                    const payload = {
                        url: url,
                        category: category,
                        memo: memo
                    };

                    // fetch 호출 (await를 사용하되 응답 결과에 상관없이 UI 유지)
                    await fetch(GAS_WEB_APP_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        cache: 'no-cache',
                        headers: {
                            'Content-Type': 'text/plain;charset=utf-8',
                        },
                        body: JSON.stringify(payload),
                    });

                    // 성공 처리
                    showStatus('success', '성공적으로 저장되었습니다!');
                    setUrl('');
                    setMemo('');
                } catch (error) {
                    console.error("Save Error:", error);
                    showStatus('error', '저장 시도가 전송되었습니다.'); // no-cors는 에러로 잡힐 수 있으나 전송은 됨
                } finally {
                    // 0.5초 후 로딩 해제하여 화면 깜빡임 방지 및 UI 복구 보장
                    setTimeout(() => setLoading(false), 500);
                }
            };

            return (
                <div className="min-h-screen flex flex-col items-center p-6 text-slate-900 overflow-x-hidden">
                    <div className="fixed top-0 left-0 w-full h-80 bg-gradient-to-b from-indigo-100/40 to-transparent -z-10" />

                    <header className="w-full max-w-md mt-6 mb-8 text-center">
                        <div className="inline-flex items-center justify-center w-16 h-16 bg-white rounded-[1.5rem] shadow-xl shadow-indigo-100/50 mb-6 border border-indigo-50">
                            <Icon name="sparkles" className="text-indigo-600 w-8 h-8" />
                        </div>
                        <h1 className="text-3xl font-black tracking-tight text-slate-900">Idea Archive</h1>
                        <p className="text-slate-400 font-medium mt-2 text-sm">소중한 영감을 놓치지 마세요</p>
                    </header>

                    <div className="w-full max-w-md bg-white rounded-[2.5rem] shadow-[0_20px_60px_rgba(79,70,229,0.06)] p-8 border border-slate-50 relative overflow-hidden flex-shrink-0">
                        <div className="space-y-8">
                            {/* URL 입력 필드 */}
                            <div>
                                <label className="flex items-center text-[11px] font-bold uppercase tracking-[0.2em] text-slate-400 mb-3 ml-1">
                                    <Icon name="link-2" className="w-3.5 h-3.5 mr-2 text-indigo-400" />
                                    Source URL
                                </label>
                                <input
                                    type="url"
                                    placeholder="주소를 붙여넣으세요"
                                    className="w-full px-5 py-4 bg-slate-50 border-0 rounded-2xl ring-1 ring-slate-100 focus:ring-2 focus:ring-indigo-500 transition-all outline-none text-slate-700 placeholder:text-slate-300"
                                    value={url}
                                    onChange={(e) => setUrl(e.target.value)}
                                />
                            </div>

                            {/* 카테고리 선택 */}
                            <div>
                                <label className="flex items-center text-[11px] font-bold uppercase tracking-[0.2em] text-slate-400 mb-4 ml-1">
                                    Category
                                </label>
                                <div className="grid grid-cols-2 gap-3">
                                    {categories.map((cat) => (
                                        <button
                                            key={cat.id}
                                            type="button"
                                            onClick={() => setCategory(cat.id)}
                                            className={`relative flex flex-col items-start p-4 rounded-2xl transition-all duration-300 border-2 ${
                                                category === cat.id 
                                                ? 'border-indigo-500 bg-indigo-50/30' 
                                                : 'border-transparent bg-slate-50 opacity-60'
                                            }`}
                                        >
                                            <div className={`p-2 rounded-xl mb-3 ${cat.bgColor} ${cat.color}`}>
                                                <Icon name={cat.icon} className="w-5 h-5" />
                                            </div>
                                            <span className={`text-sm font-bold ${category === cat.id ? 'text-indigo-900' : 'text-slate-500'}`}>
                                                {cat.id}
                                            </span>
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {/* 메모 입력 필드 */}
                            <div>
                                <label className="flex items-center text-[11px] font-bold uppercase tracking-[0.2em] text-slate-400 mb-3 ml-1">
                                    <Icon name="pen-line" className="w-3.5 h-3.5 mr-2 text-indigo-400" />
                                    Quick Memo
                                </label>
                                <textarea
                                    placeholder="아이디어를 메모하세요"
                                    className="w-full px-5 py-4 bg-slate-50 border-0 rounded-2xl ring-1 ring-slate-100 focus:ring-2 focus:ring-indigo-500 transition-all outline-none text-slate-700 placeholder:text-slate-300 h-24 resize-none"
                                    value={memo}
                                    onChange={(e) => setMemo(e.target.value)}
                                />
                            </div>

                            {/* 상태 알림창 */}
                            {status.message && (
                                <div className={`flex items-center p-4 rounded-2xl text-sm font-semibold animate-in fade-in slide-in-from-bottom-2 ${
                                    status.type === 'success' ? 'bg-emerald-50 text-emerald-700 ring-1 ring-emerald-100' : 'bg-rose-50 text-rose-700 ring-1 ring-rose-100'
                                }`}>
                                    <Icon name={status.type === 'success' ? 'check-circle-2' : 'alert-circle'} className="w-5 h-5 mr-3 shrink-0" />
                                    {status.message}
                                </div>
                            )}

                            {/* 저장 버튼 - type="button"으로 설정하여 폼 제출 차단 */}
                            <button
                                type="button"
                                onClick={handleSave}
                                disabled={loading}
                                className={`group relative w-full py-5 rounded-[1.25rem] font-bold text-lg flex items-center justify-center transition-all shadow-xl active:scale-95 ${
                                    loading 
                                    ? 'bg-slate-200 text-slate-400' 
                                    : 'bg-indigo-600 text-white shadow-indigo-200 hover:bg-indigo-700'
                                }`}
                            >
                                {loading ? (
                                    <Icon name="loader-2" className="w-6 h-6 animate-spin" />
                                ) : (
                                    <span className="flex items-center">
                                        저장하기
                                        <Icon name="arrow-right" className="w-5 h-5 ml-2 transition-transform group-hover:translate-x-1" />
                                    </span>
                                )}
                            </button>
                        </div>
                    </div>

                    <footer className="mt-8 mb-12 flex flex-col items-center">
                        <div className="px-4 py-2 bg-slate-100 rounded-full text-[10px] font-black text-slate-400 uppercase tracking-tighter">
                            Cloud Archive Connected
                        </div>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
